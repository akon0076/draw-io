<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36" version="28.2.9">
  <diagram name="第 1 页" id="yO8YtnxTppW7H_l9zT_U">
    <mxGraphModel dx="1584" dy="878" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="3300" pageHeight="4681" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-14" value="&lt;div style=&quot;&quot;&gt;&lt;b style=&quot;font-size: 16px;&quot;&gt;before mutation&lt;br&gt;&lt;/b&gt;&amp;nbsp;--&amp;nbsp;&lt;font&gt;&lt;span class=&quot;s1&quot; style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-size-adjust: none; font-language-override: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-variant-emoji: normal; font-stretch: normal; line-height: normal; font-family: &amp;quot;PingFang SC&amp;quot;;&quot;&gt;遍历&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;effectList&lt;/span&gt;&lt;span class=&quot;s1&quot; style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-size-adjust: none; font-language-override: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-variant-emoji: normal; font-stretch: normal; line-height: normal; font-family: &amp;quot;PingFang SC&amp;quot;;&quot;&gt;并调用&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;b&gt;commitBeforeMutationEffects&lt;/b&gt;&lt;/span&gt;&lt;span class=&quot;s1&quot; style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-size-adjust: none; font-language-override: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-variant-emoji: normal; font-stretch: normal; line-height: normal; font-family: &amp;quot;PingFang SC&amp;quot;;&quot;&gt;函数处理&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&amp;nbsp;-- 处理DOM节点渲染/删除后的 autoFocus、blur 逻辑。&lt;/div&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;-- 调度当前更新的useEffect的callback，并记录返回的cleanup&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;-- 调用&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;componentWillXXX&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;align=left;verticalAlign=top;sketch=1;curveFitting=1;jiggle=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1090" y="1020" width="1080" height="240" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-24" value="&lt;div style=&quot;&quot;&gt;&lt;b style=&quot;font-size: 16px;&quot;&gt;mutation&lt;/b&gt;&lt;br&gt;&lt;font&gt;&lt;span class=&quot;s1&quot; style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-size-adjust: none; font-language-override: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-variant-emoji: normal; font-stretch: normal; line-height: normal;&quot;&gt;&amp;nbsp;--&amp;nbsp;&lt;/span&gt;&lt;span class=&quot;s1&quot; style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-size-adjust: none; font-language-override: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-variant-emoji: normal; font-stretch: normal; line-height: normal; font-family: &amp;quot;PingFang SC&amp;quot;;&quot;&gt;遍历&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;effectList&lt;/span&gt;&lt;span class=&quot;s1&quot; style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-size-adjust: none; font-language-override: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-variant-emoji: normal; font-stretch: normal; line-height: normal; font-family: &amp;quot;PingFang SC&amp;quot;;&quot;&gt;，依次执行&lt;/span&gt;&lt;font style=&quot;color: rgb(0, 0, 0);&quot;&gt;&lt;b&gt;commitMutationEffects，&lt;/b&gt;&lt;/font&gt;根据effectTag调用不同的处理函数处理Fiber以及DOM&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font&gt;&amp;nbsp;--&amp;nbsp;根据ContentReset effectTag重置文字节点&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font&gt;&amp;nbsp;-- 更新ref&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font&gt;&amp;nbsp;--&amp;nbsp;根据effectTag分别处理，其中effectTag包括(Placement | Update | Deletion | Hydrating)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font&gt;&amp;nbsp;-- 同步执行useLayoutEffect 的cleanup&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;align=left;verticalAlign=top;sketch=1;curveFitting=1;jiggle=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1090" y="1290" width="1080" height="240" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="K3vkppp8Vx0ND8bOc-pT-25" target="K3vkppp8Vx0ND8bOc-pT-22">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1800" y="1340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;curveFitting=1;jiggle=2;" edge="1" parent="1" source="K3vkppp8Vx0ND8bOc-pT-1" target="K3vkppp8Vx0ND8bOc-pT-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-1" value="开始" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1730" y="690" width="170" height="50" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;curveFitting=1;jiggle=2;" edge="1" parent="1" source="K3vkppp8Vx0ND8bOc-pT-2" target="K3vkppp8Vx0ND8bOc-pT-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-2" value="commitRoot&lt;br&gt;入口" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1730" y="780" width="170" height="50" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;curveFitting=1;jiggle=2;" edge="1" parent="1" source="K3vkppp8Vx0ND8bOc-pT-4" target="K3vkppp8Vx0ND8bOc-pT-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-4" value="commitRootImpl" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1730" y="870" width="170" height="50" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-6" value="清理干净上一次更新的useEffect的callback和cleanup" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;rounded=0;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1940" y="970" width="240" height="30" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;curveFitting=1;jiggle=2;" edge="1" parent="1" source="K3vkppp8Vx0ND8bOc-pT-7" target="K3vkppp8Vx0ND8bOc-pT-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-7" value="flushPassiveEffects" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1730" y="960" width="170" height="50" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-9" value="commitBeforeMutationEffects" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1680" y="1050" width="270" height="50" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-17" value="commitBeforeMutationEffects" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1730" y="1120" width="340" height="50" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-22" value="&lt;p class=&quot;p1&quot; style=&quot;margin: 0px; font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-size-adjust: none; font-language-override: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-variant-emoji: normal; font-stretch: normal; font-size: 16px; line-height: normal; text-align: start;&quot;&gt;commitMutationEffects&lt;/p&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1680" y="1320" width="190" height="50" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-25" value="commitBeforeMutationEffectOnFiber" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1780" y="1180" width="340" height="50" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-26" value="&lt;div style=&quot;&quot;&gt;&lt;b style=&quot;font-size: 16px;&quot;&gt;Layout&lt;/b&gt;&lt;br&gt;&lt;font&gt;&lt;span class=&quot;s1&quot; style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-size-adjust: none; font-language-override: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-variant-emoji: normal; font-stretch: normal; line-height: normal;&quot;&gt;&amp;nbsp;--&amp;nbsp;commitLayoutEffectOnFiber调用componentDidXXX&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&amp;nbsp;-- 同步执行useLayoutEffect 的 callback&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font&gt;&amp;nbsp;--&amp;nbsp;&lt;/font&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;commitAttachRef 获取DOM实例，更新ref&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font&gt;&amp;nbsp;-- Fiber树切换&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font&gt;&amp;nbsp;--&amp;nbsp;&lt;/font&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;align=left;verticalAlign=top;sketch=1;curveFitting=1;jiggle=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1090" y="1570" width="1080" height="240" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-27" value="commitBeforeMutationEffectOnFiber" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1680" y="1590" width="340" height="50" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-28" value="commitLayoutEffectOnFiber" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1730" y="1665" width="300" height="50" as="geometry" />
        </mxCell>
        <mxCell id="K3vkppp8Vx0ND8bOc-pT-29" value="&lt;div&gt;commitAttachRef&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=18;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1730" y="1740" width="300" height="50" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
